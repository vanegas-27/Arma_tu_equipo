{% extends "base.html" %}
{% block title %}Editar Perfil - Arma tu equipo{% endblock %}

{% block content %}
<div class="panel-page">
    <div class="container">
        <div class="panel-header animate-fade-in-up">
            <h2>Editar perfil</h2>
            <p>Actualiza tu informacion personal</p>
        </div>

        <div class="card form-card animate-fade-in-up delay-1">
            <div class="card-header-custom">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                    <circle cx="12" cy="7" r="4"/>
                </svg>
                Datos personales
            </div>
            <div class="card-body">
                <form method="POST" enctype="multipart/form-data">
                    {{ form.hidden_tag() }}
                    
                    <!-- Foto de perfil -->
                    <div class="form-group" style="text-align: center; margin-bottom: 24px;">
                        <label class="form-label" style="display: block; margin-bottom: 8px;">Foto de perfil</label>
                        <div style="display: flex; flex-direction: column; align-items: center;">
                            <div id="previewContainer" style="width: 100px; height: 100px; border-radius: 50%; background: #f5f5f5; border: 2px dashed #ccc; display: flex; align-items: center; justify-content: center; margin-bottom: 12px; overflow: hidden; cursor: pointer;">
                                {% if current_user.foto %}
                                <img src="{{ url_for('static', filename='uploads/' + current_user.foto) }}" alt="Foto actual" style="width: 100%; height: 100%; object-fit: cover;">
                                {% else %}
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 40px; height: 40px; color: #999;">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                    <circle cx="12" cy="7" r="4"/>
                                </svg>
                                {% endif %}
                            </div>
                            {{ form.foto(class="form-control", id="fotoInput", accept="image/*", style="max-width: 200px; font-size: 14px;", onchange="previewImage(event)") }}
                            <small style="color: #666; display: block; margin-top: 8px;">JPG, PNG o WEBP</small>
                        </div>
                    </div>

                    <div class="form-group">
                        {{ form.nombre.label(class="form-label") }}
                        {{ form.nombre(class="form-control") }}
                    </div>
                    <div class="form-group">
                        {{ form.apellido.label(class="form-label") }}
                        {{ form.apellido(class="form-control") }}
                    </div>
                    <div class="form-group">
                        {{ form.telefono.label(class="form-label") }}
                        {{ form.telefono(class="form-control") }}
                    </div>
                    <div class="form-group">
                        {{ form.direccion.label(class="form-label") }}
                        {{ form.direccion(class="form-control") }}
                    </div>

                    {% if current_user.rol == "arquero" %}
                        <div style="border-top: 1px solid var(--color-border); padding-top: 20px; margin-top: 20px;">
                            <h4 style="font-size: 0.95rem; margin-bottom: 16px; color: var(--color-text);">Informacion de arquero</h4>
                            <div class="form-group">
                                {{ form.años_tapando.label(class="form-label") }}
                                {{ form.años_tapando(class="form-control", value=current_user.arquero.años_tapando if current_user.arquero else 0) }}
                            </div>
                            <div class="form-group">
                                {{ form.precio_por_hora.label(class="form-label") }}
                                {{ form.precio_por_hora(class="form-control", value=current_user.arquero.precio_por_hora if current_user.arquero else 0) }}
                            </div>
                        </div>
                    {% endif %}

                    {{ form.submit(class="btn btn-primary") }}
                </form>
            </div>
        </div>
    </div>
</div>

<script>
function previewImage(event) {
    var file = event.target.files[0];
    var preview = document.getElementById('previewContainer');
    
    if (file) {
        var reader = new FileReader();
        reader.onload = function(e) {
            preview.innerHTML = '<img src="' + e.target.result + '" alt="Preview" style="width: 100%; height: 100%; object-fit: cover;">';
        };
        reader.readAsDataURL(file);
    }
}
</script>
{% endblock %}
